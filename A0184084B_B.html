<!-- ?xml version='1.0' encoding='UTF-8'? -->
<link href="/github-markdown-css/github-css.css" rel="stylesheet"/>
<meta charset="utf-8" content="text/html"/>
<div class="gist">
<style class="formula-style">
        svg.gh-md-to-html-formula {
            fill: black;
        }
    </style>
<div class="gist-file"> <!-- This is the class that is responsible for the boxing! -->
<div class="gist-data">
<div class="js-gist-file-update-container js-task-list-container file-box">
<div class="file" id="user-content-article-A0184084B_B">
<div class="Box-body readme blob js-code-block-container p-5 p-xl-6" id="user-content-file-docker-image-pull-md-readme" style="margin-left: 40px; margin-right: 40px; margin-top: 20px; margin-bottom: 20px">
<article class="markdown-body entry-content container-lg" itemprop="text">
<h1 id="user-content-task-b-b1-b2-b3-only">
<a aria-hidden="true" class="anchor" href="#user-content-task-b-b1-b2-b3-only" id="user-content-task-b-b1-b2-b3-only" name="user-content-task-b-b1-b2-b3-only"><span aria-hidden="true" class="octicon octicon-link"></span></a>Task B (B1, B2, B3 only)</h1>
<h2 id="user-content-submission-information">
<a aria-hidden="true" class="anchor" href="#user-content-submission-information" id="user-content-submission-information" name="user-content-submission-information"><span aria-hidden="true" class="octicon octicon-link"></span></a>Submission Information</h2>
<table>
<thead>
<tr>
<th>Option</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td>Lau Jun Hao Benjamin</td>
</tr>
<tr>
<td>Matriculation Number</td>
<td>A01840840B</td>
</tr>
<tr>
<td>Link to GitHub Repository</td>
<td><a href="https://github.com/Capeguy/cs3219-otot-b">https://github.com/Capeguy/cs3219-otot-b</a></td>
</tr>
<tr>
<td>Instructions</td>
<td><a href="#user-content-foo">Below</a></td>
</tr>
<tr>
<td>Instructions</td>
<td>Submission for B1, B2, B3</td>
</tr>
<tr>
<td>Other Relevant Learnings</td>
<td>null</td>
</tr>
</tbody>
</table>
<h2 id="user-content-table-of-contents">
<a aria-hidden="true" class="anchor" href="#user-content-table-of-contents" id="user-content-table-of-contents" name="user-content-table-of-contents"><span aria-hidden="true" class="octicon octicon-link"></span></a>Table of Contents</h2>
<ul>
<li>
<a href="#user-content-task-b-b1-b2-b3-only">Task B (B1, B2, B3 only)</a>
<ul>
<li><a href="#user-content-submission-information">Submission Information</a></li>
<li><a href="#user-content-table-of-contents">Table of Contents</a></li>
<li>
<a href="#user-content-task-b1">Task B1</a>
<ul>
<li><a href="#user-content-running-instructions">Running Instructions</a></li>
<li>
<a href="#user-content-postman-on-local">Postman on Local</a>
<ul>
<li><a href="#user-content-base-url">Base URL</a></li>
<li><a href="#user-content-get-to-list-all-bobs">GET to List all Bobs</a></li>
<li><a href="#user-content-post-to-create-a-bob">POST to Create a Bob</a></li>
<li><a href="#user-content-get-after-creating-a-bob">GET after Creating a Bob</a></li>
<li><a href="#user-content-patch-to-update-a-bob">PATCH to update a Bob</a></li>
<li><a href="#user-content-delete-to-delete-a-bob">DELETE to Delete a Bob</a></li>
</ul>
</li>
<li>
<a href="#user-content-postman-on-deployed-endpoints">Postman on Deployed Endpoints</a>
<ul>
<li><a href="#user-content-get-to-list-all-bobs-1">GET to List all Bobs</a></li>
<li><a href="#user-content-post-to-create-a-bob-1">POST to Create a Bob</a></li>
<li><a href="#user-content-get-after-creating-a-bob-1">GET after Creating a Bob</a></li>
<li><a href="#user-content-patch-to-update-a-bob-1">PATCH to update a Bob</a></li>
<li><a href="#user-content-delete-to-delete-a-bob-1">DELETE to Delete a Bob</a></li>
</ul>
</li>
<li>
<a href="#user-content-handling-of-edge-cases-and-error-resiliency">Handling of Edge Cases and Error-Resiliency</a>
<ul>
<li><a href="#user-content-creating-a-bob-with-empty-name">Creating a Bob with Empty Name</a></li>
<li><a href="#user-content-updating-a-bob-with-invalid-id">Updating a Bob with Invalid ID</a></li>
<li><a href="#user-content-updating-a-deleted-bob">Updating a Deleted Bob</a></li>
<li>
<a href="#user-content-using-invalid-http-methods">Using invalid HTTP Methods</a>
<ul>
<li><a href="#user-content-purge">PURGE</a></li>
<li><a href="#user-content-head">HEAD</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#user-content-task-b2">Task B2</a>
<ul>
<li><a href="#user-content-successful-testing-of-api-using-jest">Successful Testing of API using Jest</a></li>
<li>
<a href="#user-content-use-of-ci-tools---travis">Use of CI Tools - Travis</a>
<ul>
<li><a href="#user-content-how-to-run">How to Run</a></li>
<li><a href="#user-content-travis-configuration-file">Travis Configuration File</a></li>
<li><a href="#user-content-output-of-travis-build">Output of Travis Build</a></li>
</ul>
</li>
</ul>
</li>
<li>
<a href="#user-content-task-b3">Task B3</a>
<ul>
<li>
<a href="#user-content-use-of-serverless-to-deploy-to-aws-lambda">Use of Serverless to deploy to AWS Lambda</a>
<ul>
<li><a href="#user-content-setup">Setup</a></li>
<li>
<a href="#user-content-outputs">Outputs</a>
<ul>
<li><a href="#user-content-aws-lambda-application">AWS Lambda Application</a></li>
<li><a href="#user-content-aws-lambda-function">AWS Lambda Function</a></li>
<li><a href="#user-content-aws-cloudwatch">AWS CloudWatch</a></li>
<li><a href="#user-content-aws-api-gateway">AWS API Gateway</a></li>
<li><a href="#user-content-deployed-serverless-application">Deployed Serverless Application</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="user-content-task-b1">
<a aria-hidden="true" class="anchor" href="#user-content-task-b1" id="user-content-task-b1" name="user-content-task-b1"><span aria-hidden="true" class="octicon octicon-link"></span></a>Task B1</h2>
<h3 id="user-content-running-instructions">
<a aria-hidden="true" class="anchor" href="#user-content-running-instructions" id="user-content-running-instructions" name="user-content-running-instructions"><span aria-hidden="true" class="octicon octicon-link"></span></a>Running Instructions</h3>
<pre><code>npm i
npm run start
</code></pre>
<h3 id="user-content-postman-on-local">
<a aria-hidden="true" class="anchor" href="#user-content-postman-on-local" id="user-content-postman-on-local" name="user-content-postman-on-local"><span aria-hidden="true" class="octicon octicon-link"></span></a>Postman on Local</h3>
<h4 id="user-content-base-url">
<a aria-hidden="true" class="anchor" href="#user-content-base-url" id="user-content-base-url" name="user-content-base-url"><span aria-hidden="true" class="octicon octicon-link"></span></a>Base URL</h4>
<p><a href="/images/b1.0.png" rel="noopener noreferrer" target="_blank"><img alt="Base URL" data-canonical-src="/images/b1.0.png" src="/images/b1.0.png" style="max-width:100%; max-height: 398px;"/></a></p>
<h4 id="user-content-get-to-list-all-bobs">
<a aria-hidden="true" class="anchor" href="#user-content-get-to-list-all-bobs" id="user-content-get-to-list-all-bobs" name="user-content-get-to-list-all-bobs"><span aria-hidden="true" class="octicon octicon-link"></span></a>GET to List all Bobs</h4>
<p><a href="/images/b1.1.png" rel="noopener noreferrer" target="_blank"><img alt="GET to List all Bobs" data-canonical-src="/images/b1.1.png" src="/images/b1.1.png" style="max-width:100%; max-height: 1014px;"/></a></p>
<h4 id="user-content-post-to-create-a-bob">
<a aria-hidden="true" class="anchor" href="#user-content-post-to-create-a-bob" id="user-content-post-to-create-a-bob" name="user-content-post-to-create-a-bob"><span aria-hidden="true" class="octicon octicon-link"></span></a>POST to Create a Bob</h4>
<p><a href="/images/b1.2a.png" rel="noopener noreferrer" target="_blank"><img alt="POST to Create a Bob" data-canonical-src="/images/b1.2a.png" src="/images/b1.2a.png" style="max-width:100%; max-height: 1028px;"/></a></p>
<h4 id="user-content-get-after-creating-a-bob">
<a aria-hidden="true" class="anchor" href="#user-content-get-after-creating-a-bob" id="user-content-get-after-creating-a-bob" name="user-content-get-after-creating-a-bob"><span aria-hidden="true" class="octicon octicon-link"></span></a>GET after Creating a Bob</h4>
<p><a href="/images/b1.2b.png" rel="noopener noreferrer" target="_blank"><img alt="GET after Creating a Bob" data-canonical-src="/images/b1.2b.png" src="/images/b1.2b.png" style="max-width:100%; max-height: 1004px;"/></a></p>
<h4 id="user-content-patch-to-update-a-bob">
<a aria-hidden="true" class="anchor" href="#user-content-patch-to-update-a-bob" id="user-content-patch-to-update-a-bob" name="user-content-patch-to-update-a-bob"><span aria-hidden="true" class="octicon octicon-link"></span></a>PATCH to update a Bob</h4>
<p><a href="/images/b1.3.png" rel="noopener noreferrer" target="_blank"><img alt="PATCH to update a Bob" data-canonical-src="/images/b1.3.png" src="/images/b1.3.png" style="max-width:100%; max-height: 1028px;"/></a></p>
<h4 id="user-content-delete-to-delete-a-bob">
<a aria-hidden="true" class="anchor" href="#user-content-delete-to-delete-a-bob" id="user-content-delete-to-delete-a-bob" name="user-content-delete-to-delete-a-bob"><span aria-hidden="true" class="octicon octicon-link"></span></a>DELETE to Delete a Bob</h4>
<p><a href="/images/b1.4.png" rel="noopener noreferrer" target="_blank"><img alt="DELETE to Delete a Bob" data-canonical-src="/images/b1.4.png" src="/images/b1.4.png" style="max-width:100%; max-height: 912px;"/></a></p>
<h3 id="user-content-postman-on-deployed-endpoints">
<a aria-hidden="true" class="anchor" href="#user-content-postman-on-deployed-endpoints" id="user-content-postman-on-deployed-endpoints" name="user-content-postman-on-deployed-endpoints"><span aria-hidden="true" class="octicon octicon-link"></span></a>Postman on Deployed Endpoints</h3>
<p><a href="/images/b1.5.png" rel="noopener noreferrer" target="_blank"><img alt="Base URL" data-canonical-src="/images/b1.5.png" src="/images/b1.5.png" style="max-width:100%; max-height: 416px;"/></a></p>
<h4 id="user-content-get-to-list-all-bobs-1">
<a aria-hidden="true" class="anchor" href="#user-content-get-to-list-all-bobs-1" id="user-content-get-to-list-all-bobs-1" name="user-content-get-to-list-all-bobs-1"><span aria-hidden="true" class="octicon octicon-link"></span></a>GET to List all Bobs</h4>
<p><a href="/images/b1.6.png" rel="noopener noreferrer" target="_blank"><img alt="GET to List all Bobs" data-canonical-src="/images/b1.6.png" src="/images/b1.6.png" style="max-width:100%; max-height: 874px;"/></a></p>
<h4 id="user-content-post-to-create-a-bob-1">
<a aria-hidden="true" class="anchor" href="#user-content-post-to-create-a-bob-1" id="user-content-post-to-create-a-bob-1" name="user-content-post-to-create-a-bob-1"><span aria-hidden="true" class="octicon octicon-link"></span></a>POST to Create a Bob</h4>
<p><a href="/images/b1.7a.png" rel="noopener noreferrer" target="_blank"><img alt="POST to Create a Bob" data-canonical-src="/images/b1.7a.png" src="/images/b1.7a.png" style="max-width:100%; max-height: 1014px;"/></a></p>
<h4 id="user-content-get-after-creating-a-bob-1">
<a aria-hidden="true" class="anchor" href="#user-content-get-after-creating-a-bob-1" id="user-content-get-after-creating-a-bob-1" name="user-content-get-after-creating-a-bob-1"><span aria-hidden="true" class="octicon octicon-link"></span></a>GET after Creating a Bob</h4>
<p><a href="/images/b1.7b.png" rel="noopener noreferrer" target="_blank"><img alt="GET after Creating a Bob" data-canonical-src="/images/b1.7b.png" src="/images/b1.7b.png" style="max-width:100%; max-height: 1090px;"/></a></p>
<h4 id="user-content-patch-to-update-a-bob-1">
<a aria-hidden="true" class="anchor" href="#user-content-patch-to-update-a-bob-1" id="user-content-patch-to-update-a-bob-1" name="user-content-patch-to-update-a-bob-1"><span aria-hidden="true" class="octicon octicon-link"></span></a>PATCH to update a Bob</h4>
<p><a href="/images/b1.8.png" rel="noopener noreferrer" target="_blank"><img alt="PATCH to update a Bob" data-canonical-src="/images/b1.8.png" src="/images/b1.8.png" style="max-width:100%; max-height: 1010px;"/></a></p>
<h4 id="user-content-delete-to-delete-a-bob-1">
<a aria-hidden="true" class="anchor" href="#user-content-delete-to-delete-a-bob-1" id="user-content-delete-to-delete-a-bob-1" name="user-content-delete-to-delete-a-bob-1"><span aria-hidden="true" class="octicon octicon-link"></span></a>DELETE to Delete a Bob</h4>
<p><a href="/images/b1.9.png" rel="noopener noreferrer" target="_blank"><img alt="DELETE to Delete a Bob" data-canonical-src="/images/b1.9.png" src="/images/b1.9.png" style="max-width:100%; max-height: 902px;"/></a></p>
<h3 id="user-content-handling-of-edge-cases-and-error-resiliency">
<a aria-hidden="true" class="anchor" href="#user-content-handling-of-edge-cases-and-error-resiliency" id="user-content-handling-of-edge-cases-and-error-resiliency" name="user-content-handling-of-edge-cases-and-error-resiliency"><span aria-hidden="true" class="octicon octicon-link"></span></a>Handling of Edge Cases and Error-Resiliency</h3>
<h4 id="user-content-creating-a-bob-with-empty-name">
<a aria-hidden="true" class="anchor" href="#user-content-creating-a-bob-with-empty-name" id="user-content-creating-a-bob-with-empty-name" name="user-content-creating-a-bob-with-empty-name"><span aria-hidden="true" class="octicon octicon-link"></span></a>Creating a Bob with Empty Name</h4>
<p><a href="/images/b1.10.png" rel="noopener noreferrer" target="_blank"><img alt="Creating a Bob with Empty Name" data-canonical-src="/images/b1.10.png" src="/images/b1.10.png" style="max-width:100%; max-height: 970px;"/></a></p>
<h4 id="user-content-updating-a-bob-with-invalid-id">
<a aria-hidden="true" class="anchor" href="#user-content-updating-a-bob-with-invalid-id" id="user-content-updating-a-bob-with-invalid-id" name="user-content-updating-a-bob-with-invalid-id"><span aria-hidden="true" class="octicon octicon-link"></span></a>Updating a Bob with Invalid ID</h4>
<p><a href="/images/b1.11.png" rel="noopener noreferrer" target="_blank"><img alt="Creating a Bob with Empty Name" data-canonical-src="/images/b1.11.png" src="/images/b1.11.png" style="max-width:100%; max-height: 1062px;"/></a></p>
<h4 id="user-content-updating-a-deleted-bob">
<a aria-hidden="true" class="anchor" href="#user-content-updating-a-deleted-bob" id="user-content-updating-a-deleted-bob" name="user-content-updating-a-deleted-bob"><span aria-hidden="true" class="octicon octicon-link"></span></a>Updating a Deleted Bob</h4>
<p><a href="/images/b1.12.png" rel="noopener noreferrer" target="_blank"><img alt="Creating a Bob with Empty Name" data-canonical-src="/images/b1.12.png" src="/images/b1.12.png" style="max-width:100%; max-height: 948px;"/></a></p>
<h4 id="user-content-using-invalid-http-methods">
<a aria-hidden="true" class="anchor" href="#user-content-using-invalid-http-methods" id="user-content-using-invalid-http-methods" name="user-content-using-invalid-http-methods"><span aria-hidden="true" class="octicon octicon-link"></span></a>Using invalid HTTP Methods</h4>
<h5 id="user-content-purge">
<a aria-hidden="true" class="anchor" href="#user-content-purge" id="user-content-purge" name="user-content-purge"><span aria-hidden="true" class="octicon octicon-link"></span></a>PURGE</h5>
<p><a href="/images/b1.13a.png" rel="noopener noreferrer" target="_blank"><img alt="Creating a Bob with Empty Name" data-canonical-src="/images/b1.13a.png" src="/images/b1.13a.png" style="max-width:100%; max-height: 924px;"/></a></p>
<h5 id="user-content-head">
<a aria-hidden="true" class="anchor" href="#user-content-head" id="user-content-head" name="user-content-head"><span aria-hidden="true" class="octicon octicon-link"></span></a>HEAD</h5>
<p><a href="/images/b1.13b.png" rel="noopener noreferrer" target="_blank"><img alt="Creating a Bob with Empty Name" data-canonical-src="/images/b1.13b.png" src="/images/b1.13b.png" style="max-width:100%; max-height: 966px;"/></a></p>
<h2 id="user-content-task-b2">
<a aria-hidden="true" class="anchor" href="#user-content-task-b2" id="user-content-task-b2" name="user-content-task-b2"><span aria-hidden="true" class="octicon octicon-link"></span></a>Task B2</h2>
<h3 id="user-content-successful-testing-of-api-using-jest">
<a aria-hidden="true" class="anchor" href="#user-content-successful-testing-of-api-using-jest" id="user-content-successful-testing-of-api-using-jest" name="user-content-successful-testing-of-api-using-jest"><span aria-hidden="true" class="octicon octicon-link"></span></a>Successful Testing of API using Jest</h3>
<p>Command:</p>
<p><code>yarn test</code> or <code>node --inspect-brk node_modules/.bin/jest --runInBand</code></p>
<p>Tests are located in: <code>/tests/</code></p>
<p>Database is initialised and cleared before each test via <code>/tests/utils/setupTestDB.js</code></p>
<p>Custom Tests are located in <code>/tests/integration/bob.test.js</code></p>
<p>Test Run Outputs</p>
<p><a href="/images/b2.1a.png" rel="noopener noreferrer" target="_blank"><img alt="Test Run Output 1" data-canonical-src="/images/b2.1a.png" src="/images/b2.1a.png" style="max-width:100%; max-height: 648px;"/></a>
<a href="/images/b2.1b.png" rel="noopener noreferrer" target="_blank"><img alt="Test Run Output 2" data-canonical-src="/images/b2.1b.png" src="/images/b2.1b.png" style="max-width:100%; max-height: 204px;"/></a></p>
<h3 id="user-content-use-of-ci-tools---travis">
<a aria-hidden="true" class="anchor" href="#user-content-use-of-ci-tools---travis" id="user-content-use-of-ci-tools---travis" name="user-content-use-of-ci-tools---travis"><span aria-hidden="true" class="octicon octicon-link"></span></a>Use of CI Tools - Travis</h3>
<h4 id="user-content-how-to-run">
<a aria-hidden="true" class="anchor" href="#user-content-how-to-run" id="user-content-how-to-run" name="user-content-how-to-run"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to Run</h4>
<p>Travis Build is configured to run automatically upon commits to the <code>main</code> branch.</p>
<h4 id="user-content-travis-configuration-file">
<a aria-hidden="true" class="anchor" href="#user-content-travis-configuration-file" id="user-content-travis-configuration-file" name="user-content-travis-configuration-file"><span aria-hidden="true" class="octicon octicon-link"></span></a>Travis Configuration File</h4>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">language</span>: <span class="pl-s">node_js</span>
<span class="pl-ent">os</span>: <span class="pl-s">linux</span>
<span class="pl-ent">dist</span>: <span class="pl-s">xenial</span>
<span class="pl-ent">node_js</span>:
- <span class="pl-s"><span class="pl-pds">'</span>12<span class="pl-pds">'</span></span>
<span class="pl-ent">services</span>:
- <span class="pl-s">mongodb</span>
<span class="pl-ent">cache</span>: <span class="pl-s">yarn</span>
<span class="pl-ent">branches</span>:
  <span class="pl-ent">only</span>:
  - <span class="pl-s">main</span>
<span class="pl-ent">env</span>:
  <span class="pl-ent">global</span>:
  - <span class="pl-s">PORT=3000</span>
  - <span class="pl-s">MONGODB_URL=mongodb://localhost:27017/app</span>
  - <span class="pl-s">JWT_SECRET=thisisasamplesecret</span>
  - <span class="pl-s">JWT_ACCESS_EXPIRATION_MINUTES=30</span>
  - <span class="pl-s">JWT_REFRESH_EXPIRATION_DAYS=30</span>
<span class="pl-ent">script</span>:
- <span class="pl-s">yarn lint</span>
- <span class="pl-s">yarn test</span>
<span class="pl-ent">after_success</span>: <span class="pl-s">yarn coverage:coveralls</span></pre></div>
<p>Lines 4-5: State that the job should run on Node version 12</p>
<p>Line 9-11: State that the job should only run on the <code>main</code> branch</p>
<p>Line 7: State the Services required (i.e. Mongo DB)</p>
<p>Line 20: Checks that the files are linted</p>
<p>Line 21: Start the tests ( <code>yarn test</code> which runs <code>jest -i --colors --verbose</code> as defined in package.json)</p>
<p>Line 22: Upon job success, generate coverage report</p>
<h4 id="user-content-output-of-travis-build">
<a aria-hidden="true" class="anchor" href="#user-content-output-of-travis-build" id="user-content-output-of-travis-build" name="user-content-output-of-travis-build"><span aria-hidden="true" class="octicon octicon-link"></span></a>Output of Travis Build</h4>
<p><a href="/images/b2.3.png" rel="noopener noreferrer" target="_blank"><img alt="Output of Travis Build" data-canonical-src="/images/b2.3.png" src="/images/b2.3.png" style="max-width:100%; max-height: 16688px;"/></a></p>
<h2 id="user-content-task-b3">
<a aria-hidden="true" class="anchor" href="#user-content-task-b3" id="user-content-task-b3" name="user-content-task-b3"><span aria-hidden="true" class="octicon octicon-link"></span></a>Task B3</h2>
<h3 id="user-content-use-of-serverless-to-deploy-to-aws-lambda">
<a aria-hidden="true" class="anchor" href="#user-content-use-of-serverless-to-deploy-to-aws-lambda" id="user-content-use-of-serverless-to-deploy-to-aws-lambda" name="user-content-use-of-serverless-to-deploy-to-aws-lambda"><span aria-hidden="true" class="octicon octicon-link"></span></a>Use of Serverless to deploy to AWS Lambda</h3>
<h4 id="user-content-setup">
<a aria-hidden="true" class="anchor" href="#user-content-setup" id="user-content-setup" name="user-content-setup"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup</h4>
<p>travis.yml</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">deploy_service_job</span>: <span class="pl-s">&amp;DEPLOY_SERVICE_JOB</span>
  <span class="pl-ent">cache</span>:
    <span class="pl-ent">directories</span>:
      - <span class="pl-s">node_modules</span>
      - <span class="pl-s">${SERVICE_PATH}/node_modules</span>

  <span class="pl-ent">install</span>:
    - <span class="pl-s">npm install -g serverless</span>
    - <span class="pl-s">travis_retry npm install</span>
    - <span class="pl-s">cd ${SERVICE_PATH}</span>
    - <span class="pl-s">travis_retry npm install</span>
    - <span class="pl-s">cd -</span>

  <span class="pl-ent">script</span>:
    - <span class="pl-s">cd ${SERVICE_PATH}</span>
    - <span class="pl-s">serverless deploy -s ${STAGE_NAME}</span>
    - <span class="pl-s">cd -</span>

<span class="pl-ent">jobs</span>:
  <span class="pl-ent">include</span>:
    <span class="pl-c"><span class="pl-c">#</span> master branch deploys to the 'dev' stage</span>
    - <span class="pl-ent">&lt;&lt;</span>: <span class="pl-s">*DEPLOY_SERVICE_JOB</span>
      <span class="pl-ent">name</span>: <span class="pl-s"><span class="pl-pds">"</span>Deploy API<span class="pl-pds">"</span></span>
      <span class="pl-ent">if</span>: <span class="pl-s">type = push AND branch = main</span>
      <span class="pl-ent">env</span>:
        - <span class="pl-s">SERVICE_PATH="."</span>
        - <span class="pl-s">STAGE_NAME=dev</span>
      <span class="pl-c"><span class="pl-c">#</span> - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}</span>
      <span class="pl-c"><span class="pl-c">#</span> - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}</span></pre></div>
<p>serverless.yml</p>
<div class="highlight highlight-source-yaml"><pre><span class="pl-ent">service</span>: <span class="pl-s">cs3219-taskb-serverless-2</span>
<span class="pl-ent">app</span>: <span class="pl-s">cs3219-taskb-serverless-2</span>
<span class="pl-ent">org</span>: <span class="pl-s">capeguy</span>

<span class="pl-ent">frameworkVersion</span>: <span class="pl-s"><span class="pl-pds">'</span>2<span class="pl-pds">'</span></span>

<span class="pl-ent">provider</span>:
  <span class="pl-ent">name</span>: <span class="pl-s">aws</span>
  <span class="pl-ent">runtime</span>: <span class="pl-s">nodejs12.x</span>
  <span class="pl-ent">region</span>: <span class="pl-s">ap-southeast-1</span>
  <span class="pl-ent">lambdaHashingVersion</span>: <span class="pl-c1">20201221</span>

<span class="pl-ent">functions</span>:
  <span class="pl-ent">hello</span>:
    <span class="pl-ent">handler</span>: <span class="pl-s">src/index.handler</span>
    <span class="pl-ent">events</span>:
      - <span class="pl-ent">http</span>:
          <span class="pl-ent">path</span>: <span class="pl-s">/{proxy+}</span>
          <span class="pl-ent">method</span>: <span class="pl-s">ANY</span>
    <span class="pl-ent">environment</span>:
      <span class="pl-ent">PORT</span>: <span class="pl-c1">3000</span>
      <span class="pl-ent">MONGODB_URL</span>: <span class="pl-s">&lt;snip&gt;</span>
      <span class="pl-ent">JWT_SECRET</span>: <span class="pl-s">thisisasamplesecret</span>
      <span class="pl-ent">JWT_ACCESS_EXPIRATION_MINUTES</span>: <span class="pl-c1">30</span>
      <span class="pl-ent">JWT_REFRESH_EXPIRATION_DAYS</span>: <span class="pl-c1">30</span>
      <span class="pl-ent">JWT_RESET_PASSWORD_EXPIRATION_MINUTES</span>: <span class="pl-c1">10</span>
      <span class="pl-ent">JWT_VERIFY_EMAIL_EXPIRATION_MINUTES</span>: <span class="pl-c1">10</span>
      <span class="pl-ent">NODE_ENV</span>: <span class="pl-s">production</span></pre></div>
<p>Serverless Credentials and AWS Keys are provided as encrypted travis environment variables:</p>
<p><code>travis encrypt "VariableName=VariableValue" --pro</code></p>
<p>This configuration deploys the code as an AWS Lambda Application and Functions with the required environment variables, along with the required resources through AWS CloudFormation (e.g. S3, CloudWatch LogGroups, API Gateway).</p>
<p>It also configures an the AWS API Gateway in the <code>dev</code> stage as the trigger, accepting all HTTP request paths and forwarding them to the Lambda. Upon event triggered in AWS Lambda, the function in <code>src/index.handler</code> is invoked, which is defined as</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">module</span><span class="pl-kos">.</span><span class="pl-c1">exports</span><span class="pl-kos">.</span><span class="pl-c1">handler</span> <span class="pl-c1">=</span> <span class="pl-en">serverless</span><span class="pl-kos">(</span><span class="pl-s1">app</span><span class="pl-kos">)</span><span class="pl-kos">;</span></pre></div>
<h4 id="user-content-outputs">
<a aria-hidden="true" class="anchor" href="#user-content-outputs" id="user-content-outputs" name="user-content-outputs"><span aria-hidden="true" class="octicon octicon-link"></span></a>Outputs</h4>
<h5 id="user-content-aws-lambda-application">
<a aria-hidden="true" class="anchor" href="#user-content-aws-lambda-application" id="user-content-aws-lambda-application" name="user-content-aws-lambda-application"><span aria-hidden="true" class="octicon octicon-link"></span></a>AWS Lambda Application</h5>
<p><a href="/images/b3.1.png" rel="noopener noreferrer" target="_blank"><img alt="AWS Lambda Application" data-canonical-src="/images/b3.1.png" src="/images/b3.1.png" style="max-width:100%; max-height: 2064px;"/></a></p>
<h5 id="user-content-aws-lambda-function">
<a aria-hidden="true" class="anchor" href="#user-content-aws-lambda-function" id="user-content-aws-lambda-function" name="user-content-aws-lambda-function"><span aria-hidden="true" class="octicon octicon-link"></span></a>AWS Lambda Function</h5>
<p><a href="/images/b3.2.png" rel="noopener noreferrer" target="_blank"><img alt="AWS Lambda Function" data-canonical-src="/images/b3.2.png" src="/images/b3.2.png" style="max-width:100%; max-height: 2702px;"/></a></p>
<h5 id="user-content-aws-cloudwatch">
<a aria-hidden="true" class="anchor" href="#user-content-aws-cloudwatch" id="user-content-aws-cloudwatch" name="user-content-aws-cloudwatch"><span aria-hidden="true" class="octicon octicon-link"></span></a>AWS CloudWatch</h5>
<p><a href="/images/b3.3.png" rel="noopener noreferrer" target="_blank"><img alt="AWS CloudWatch" data-canonical-src="/images/b3.3.png" src="/images/b3.3.png" style="max-width:100%; max-height: 1778px;"/></a></p>
<h5 id="user-content-aws-api-gateway">
<a aria-hidden="true" class="anchor" href="#user-content-aws-api-gateway" id="user-content-aws-api-gateway" name="user-content-aws-api-gateway"><span aria-hidden="true" class="octicon octicon-link"></span></a>AWS API Gateway</h5>
<p><a href="/images/b3.4.png" rel="noopener noreferrer" target="_blank"><img alt="AWS API Gateway" data-canonical-src="/images/b3.4.png" src="/images/b3.4.png" style="max-width:100%; max-height: 1778px;"/></a></p>
<h5 id="user-content-deployed-serverless-application">
<a aria-hidden="true" class="anchor" href="#user-content-deployed-serverless-application" id="user-content-deployed-serverless-application" name="user-content-deployed-serverless-application"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deployed Serverless Application</h5>
<p><a href="/images/b3.5.png" rel="noopener noreferrer" target="_blank"><img alt="Deployed Serverless Application" data-canonical-src="/images/b3.5.png" src="/images/b3.5.png" style="max-width:100%; max-height: 1556px;"/></a></p>
</article>
</div>
</div>
</div>
</div>
</div>
</div>
